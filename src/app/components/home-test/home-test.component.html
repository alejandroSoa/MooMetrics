<div class="header">
  <button *ngIf="showChat" class="back-button mobile-only" (click)="backToChannels()" aria-label="Back">
    <fa-icon [icon]="faArrowLeft"></fa-icon>
  </button>
  <h1>MooMetrics</h1>
  
  <!-- Network Status Indicator -->
  <div class="network-status" [class.online]="isOnline" [class.offline]="!isOnline">
    <span class="status-dot"></span>
    <span class="status-text">{{ isOnline ? 'En lÃ­nea' : 'Sin conexiÃ³n' }}</span>
    <span *ngIf="!isOnline" class="cache-indicator">ðŸ“¦ Datos offline</span>
  </div>
</div>

<!-- Content Area -->
<div class="content-area">
  <!-- Stables Sidebar -->
  <div class="stables-sidebar" [class.mobile-hidden]="showChat">
    <h3>Available Stables</h3>
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <p>Cargando establos...</p>
    </div>
    
    <!-- Error State -->
    <div *ngIf="!isLoading && errorMessage" class="error-state">
      <p>{{ errorMessage }}</p>
    </div>
    
    <!-- Stable Items -->
    <div *ngIf="!isLoading && !errorMessage" class="stable-list">
      <div *ngFor="let stable of stables; let i = index" class="stable-item">
        <div class="stable-header" (click)="toggleStable(i)">
          <span class="stable-name">{{ stable.name }}</span>
          <span class="toggle-icon" [class.expanded]="stable.isExpanded">
            {{ stable.isExpanded ? 'â–¼' : 'â–¶' }}
          </span>
        </div>
        
        <!-- Channels (show when expanded) -->
        <div *ngIf="stable.isExpanded" class="sub-items">
          <!-- Loading channels -->
          <div *ngIf="stable.isLoadingChannels" class="loading-channels">
            <p>Cargando canales...</p>
          </div>
          
          <!-- Empty channels -->
          <div *ngIf="!stable.isLoadingChannels && stable.channels.length === 0" class="empty-channels">
            <p>No hay canales disponibles</p>
          </div>
          
          <!-- Channel list -->
          <div 
            *ngFor="let channel of stable.channels; let j = index" 
            class="sub-item"
            [class.active]="channel.isActive"
            (click)="selectChannel(i, j)">
            {{ channel.name }}
            <span *ngIf="channel.isLoadingMessages" class="loading-messages">...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Chat Area -->
  <div class="chat-area" [class.mobile-hidden]="!showChat">
    <!-- Chat Header -->
    <div class="chat-header">
      <div *ngIf="!botMode">
        <h2 *ngIf="selectedChannel">{{ selectedChannel.name }}</h2>
        <h2 *ngIf="!selectedChannel">Selecciona un canal</h2>
      </div>
      <div *ngIf="botMode" class="bot-mode-header">
        <div class="bot-mode-info">
          <span class="bot-mode-icon">ðŸ¤–</span>
          <span class="bot-mode-title">ConversaciÃ³n con MooBot</span>
          <span class="bot-mode-subtitle">(Modo privado - no se guarda)</span>
        </div>
        <button class="exit-bot-button" (click)="exitBotMode()" title="Salir del modo bot">
          <span>âœ•</span>
        </button>
      </div>
    </div>
    
    <!-- No channel selected -->
    <div *ngIf="!selectedChannel" class="no-channel-selected">
      <p>Selecciona un canal para comenzar a chatear</p>
    </div>
    
    <!-- Chat Messages -->
    <div *ngIf="selectedChannel" class="chat-messages">
      <!-- Loading messages -->
      <div *ngIf="selectedChannel.isLoadingMessages" class="loading-messages-area">
        <p>Cargando mensajes...</p>
      </div>
      
      <!-- Messages -->
      <div *ngIf="!selectedChannel.isLoadingMessages" class="messages-container" #messagesContainer>
        <div *ngFor="let message of currentChatMessages" class="message" [class.bot-message]="message.isBot">
          <div class="message-avatar">
            <div class="avatar-circle">
              {{ message.user.charAt(0) }}
            </div>
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="username">{{ message.user }}</span>
            </div>
            <div class="message-text">{{ message.message }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bot Options Menu -->
    <div *ngIf="botMode && showBotMenu" class="bot-menu-container">
      <div class="bot-menu">
        <div class="bot-menu-header">
          <span class="bot-icon">ðŸ¤–</span>
          <span class="bot-title">MooBot - Opciones</span>
        </div>
        <div class="bot-options">
          <button 
            *ngFor="let option of botOptions" 
            class="bot-option"
            (click)="selectBotOption(option)">
            {{ option.label }}
          </button>
        </div>
      </div>
    </div>

    <!-- Quick Access Buttons for Bot Mode -->
    <div *ngIf="botMode" class="quick-access-container">
      <div class="quick-access-header">
        <span class="quick-access-title">Acceso RÃ¡pido:</span>
      </div>
      <div class="quick-access-buttons">
        <button 
          *ngFor="let button of quickAccessButtons" 
          class="quick-access-btn"
          (click)="selectQuickAction(button)"
          [title]="button.label">
          <span class="quick-btn-icon">{{ button.icon }}</span>
          <span class="quick-btn-label">{{ button.label }}</span>
        </button>
      </div>
    </div>

    <!-- Message Input -->
    <div *ngIf="selectedChannel" class="message-input-container">
      <!-- Commands Dropdown -->
      <div *ngIf="showCommands" class="commands-dropdown">
        <div class="commands-header">
          <span class="commands-icon">#</span>
          <span class="commands-title">Comandos disponibles</span>
        </div>
        <div class="commands-list">
          <div 
            *ngFor="let command of availableCommands" 
            class="command-item"
            (click)="executeCommand(command.name)">
            <span class="command-name">{{ command.name }}</span>
            <span class="command-description">{{ command.description }}</span>
          </div>
        </div>
      </div>
      
      <input 
        type="text" 
        placeholder="Escribe tu mensaje aquÃ­... (usa # para comandos)" 
        [(ngModel)]="messageInput"
        (input)="onInputChange()"
        (keyup.enter)="sendMessage()"
        class="message-input">
      <button (click)="sendMessage()" class="send-button" [disabled]="!messageInput.trim()">
        <img src="assets/images/send-button-icon.png" alt="Send" style="width:25px;height:25px;" />
      </button>
    </div>
  </div>
</div>
